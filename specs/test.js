var path = require('path');
var tester = require('gitbook-tester');
var assert = require('assert');
const content = "```puml\n" +
    "@startuml\n" +
    "Object <|-- ArrayList\n" +
    "Object : equals()\n" +
    "ArrayList : Object[] elementData\n" +
    "ArrayList : size()\n" +
    "@enduml\n" +
    "```";
const matched = '<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMjEzcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDoxNDFweDtoZWlnaHQ6MjEzcHg7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNDEgMjEzIiB3aWR0aD0iMTQxcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzPjxmaWx0ZXIgaGVpZ2h0PSIzMDAlIiBpZD0iZnh2MG5kZzc3YWtyZyIgd2lkdGg9IjMwMCUiIHg9Ii0xIiB5PSItMSI+PGZlR2F1c3NpYW5CbHVyIHJlc3VsdD0iYmx1ck91dCIgc3RkRGV2aWF0aW9uPSIyLjAiLz48ZmVDb2xvck1hdHJpeCBpbj0iYmx1ck91dCIgcmVzdWx0PSJibHVyT3V0MiIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIC40IDAiLz48ZmVPZmZzZXQgZHg9IjQuMCIgZHk9IjQuMCIgaW49ImJsdXJPdXQyIiByZXN1bHQ9ImJsdXJPdXQzIi8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iYmx1ck91dDMiIG1vZGU9Im5vcm1hbCIvPjwvZmlsdGVyPjwvZGVmcz48Zz48IS0tY2xhc3MgT2JqZWN0LS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2Z4djBuZGc3N2FrcmcpIiBoZWlnaHQ9IjYwLjk1NTEiIGlkPSJPYmplY3QiIHN0eWxlPSJzdHJva2U6ICNBODAwMzY7IHN0cm9rZS13aWR0aDogMS41OyIgd2lkdGg9IjcwIiB4PSIzMyIgeT0iOCIvPjxlbGxpcHNlIGN4PSI0OCIgY3k9IjI0IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTogI0E4MDAzNjsgc3Ryb2tlLXdpZHRoOiAxLjA7Ii8+PHBhdGggZD0iTTUwLjQ3MzEsMzAuMTQzMSBRNDkuODkyMSwzMC40NDE5IDQ5LjI1MjksMzAuNTkxMyBRNDguNjEzOCwzMC43NDA3IDQ3LjkwODIsMzAuNzQwNyBRNDUuNDAxNCwzMC43NDA3IDQ0LjA4MTUsMjkuMDg4OSBRNDIuNzYxNywyNy40MzcgNDIuNzYxNywyNC4zMTU5IFE0Mi43NjE3LDIxLjE4NjUgNDQuMDgxNSwxOS41MzQ3IFE0NS40MDE0LDE3Ljg4MjggNDcuOTA4MiwxNy44ODI4IFE0OC42MTM4LDE3Ljg4MjggNDkuMjYxMiwxOC4wMzIyIFE0OS45MDg3LDE4LjE4MTYgNTAuNDczMSwxOC40ODA1IEw1MC40NzMxLDIxLjIwMzEgUTQ5Ljg0MjMsMjAuNjIyMSA0OS4yNDg4LDIwLjM1MjMgUTQ4LjY1NTMsMjAuMDgyNSA0OC4wMjQ0LDIwLjA4MjUgUTQ2LjY3OTcsMjAuMDgyNSA0NS45OTQ5LDIxLjE0OTIgUTQ1LjMxMDEsMjIuMjE1OCA0NS4zMTAxLDI0LjMxNTkgUTQ1LjMxMDEsMjYuNDA3NyA0NS45OTQ5LDI3LjQ3NDQgUTQ2LjY3OTcsMjguNTQxIDQ4LjAyNDQsMjguNTQxIFE0OC42NTUzLDI4LjU0MSA0OS4yNDg4LDI4LjI3MTIgUTQ5Ljg0MjMsMjguMDAxNSA1MC40NzMxLDI3LjQyMDQgWiAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nQW5kR2x5cGhzIiB0ZXh0TGVuZ3RoPSIzOCIgeD0iNjIiIHk9IjI4LjUzNTIiPk9iamVjdDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiAjQTgwMDM2OyBzdHJva2Utd2lkdGg6IDEuNTsiIHgxPSIzNCIgeDI9IjEwMiIgeTE9IjQwIiB5Mj0iNDAiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiAjQTgwMDM2OyBzdHJva2Utd2lkdGg6IDEuNTsiIHgxPSIzNCIgeDI9IjEwMiIgeTE9IjQ4IiB5Mj0iNDgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nQW5kR2x5cGhzIiB0ZXh0TGVuZ3RoPSI0MyIgeD0iMzkiIHk9IjYyLjYzNDgiPmVxdWFscygpPC90ZXh0PjwhLS1jbGFzcyBBcnJheUxpc3QtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnh2MG5kZzc3YWtyZykiIGhlaWdodD0iNzMuOTEwMiIgaWQ9IkFycmF5TGlzdCIgc3R5bGU9InN0cm9rZTogI0E4MDAzNjsgc3Ryb2tlLXdpZHRoOiAxLjU7IiB3aWR0aD0iMTI0IiB4PSI2IiB5PSIxMjkiLz48ZWxsaXBzZSBjeD0iMzkuOSIgY3k9IjE0NSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6ICNBODAwMzY7IHN0cm9rZS13aWR0aDogMS4wOyIvPjxwYXRoIGQ9Ik00Mi4zNzMxLDE1MS4xNDMxIFE0MS43OTIxLDE1MS40NDE5IDQxLjE1MjksMTUxLjU5MTMgUTQwLjUxMzgsMTUxLjc0MDcgMzkuODA4MiwxNTEuNzQwNyBRMzcuMzAxNCwxNTEuNzQwNyAzNS45ODE1LDE1MC4wODg5IFEzNC42NjE3LDE0OC40MzcgMzQuNjYxNywxNDUuMzE1OSBRMzQuNjYxNywxNDIuMTg2NSAzNS45ODE1LDE0MC41MzQ3IFEzNy4zMDE0LDEzOC44ODI4IDM5LjgwODIsMTM4Ljg4MjggUTQwLjUxMzgsMTM4Ljg4MjggNDEuMTYxMiwxMzkuMDMyMiBRNDEuODA4NywxMzkuMTgxNiA0Mi4zNzMxLDEzOS40ODA1IEw0Mi4zNzMxLDE0Mi4yMDMxIFE0MS43NDIzLDE0MS42MjIxIDQxLjE0ODgsMTQxLjM1MjMgUTQwLjU1NTMsMTQxLjA4MjUgMzkuOTI0NCwxNDEuMDgyNSBRMzguNTc5NywxNDEuMDgyNSAzNy44OTQ5LDE0Mi4xNDkyIFEzNy4yMTAxLDE0My4yMTU4IDM3LjIxMDEsMTQ1LjMxNTkgUTM3LjIxMDEsMTQ3LjQwNzcgMzcuODk0OSwxNDguNDc0NCBRMzguNTc5NywxNDkuNTQxIDM5LjkyNDQsMTQ5LjU0MSBRNDAuNTU1MywxNDkuNTQxIDQxLjE0ODgsMTQ5LjI3MTIgUTQxLjc0MjMsMTQ5LjAwMTUgNDIuMzczMSwxNDguNDIwNCBaICIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmdBbmRHbHlwaHMiIHRleHRMZW5ndGg9IjUwIiB4PSI1OC4xIiB5PSIxNDkuNTM1MiI+QXJyYXlMaXN0PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6ICNBODAwMzY7IHN0cm9rZS13aWR0aDogMS41OyIgeDE9IjciIHgyPSIxMjkiIHkxPSIxNjEiIHkyPSIxNjEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nQW5kR2x5cGhzIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjEyIiB5PSIxNzUuNjM0OCI+T2JqZWN0W10gZWxlbWVudERhdGE8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTogI0E4MDAzNjsgc3Ryb2tlLXdpZHRoOiAxLjU7IiB4MT0iNyIgeDI9IjEyOSIgeTE9IjE4MS45NTUxIiB5Mj0iMTgxLjk1NTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nQW5kR2x5cGhzIiB0ZXh0TGVuZ3RoPSIyOSIgeD0iMTIiIHk9IjE5Ni41ODk4Ij5zaXplKCk8L3RleHQ+PCEtLWxpbmsgT2JqZWN0IHRvIEFycmF5TGlzdC0tPjxwYXRoIGQ9Ik02OCw4OS40MzA4IEM2OCwxMDIuNjE0OSA2OCwxMTYuNTYyIDY4LDEyOC44ODg4ICIgZmlsbD0ibm9uZSIgaWQ9Ik9iamVjdC1BcnJheUxpc3QiIHN0eWxlPSJzdHJva2U6ICNBODAwMzY7IHN0cm9rZS13aWR0aDogMS4wOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNjEuMDAwMSw4OS4wMzk1LDY4LDY5LjAzOTQsNzUuMDAwMSw4OS4wMzk0LDYxLjAwMDEsODkuMDM5NSIgc3R5bGU9InN0cm9rZTogI0E4MDAzNjsgc3Ryb2tlLXdpZHRoOiAxLjA7Ii8+PCEtLQpAc3RhcnR1bWwNCk9iamVjdCA8fC0gLSBBcnJheUxpc3QNCk9iamVjdCA6IGVxdWFscygpDQpBcnJheUxpc3QgOiBPYmplY3RbXSBlbGVtZW50RGF0YQ0KQXJyYXlMaXN0IDogc2l6ZSgpDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMTguMTIoU3VuIE9jdCAyMSAxODoxNToxNSBDU1QgMjAxOCkKKEdQTCBzb3VyY2UgZGlzdHJpYnV0aW9uKQpKYXZhIFJ1bnRpbWU6IEphdmEoVE0pIFNFIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBKYXZhIEhvdFNwb3QoVE0pIDY0LUJpdCBTZXJ2ZXIgVk0KSmF2YSBWZXJzaW9uOiAxLjguMF8xMDEtYjEzCk9wZXJhdGluZyBTeXN0ZW06IE1hYyBPUyBYCk9TIFZlcnNpb246IDEwLjE0LjEKRGVmYXVsdCBFbmNvZGluZzogVVMtQVNDSUkKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IFVTCi0tPjwvZz48L3N2Zz4="></p>';
tester.builder()
    .withContent(content)
    .withBookJson({
        plugins: ['GraphvizAndPlantUML'],
        pluginsConfig: {
            GraphvizAndPlantUML: {
                "GraphvizDotFile": "/usr/local/opt/graphviz/bin/dot",
                "PlantJar": "/usr/local/Cellar/plantuml/1.2018.12/libexec/plantuml.jar"
            }
        }
    })
    .withLocalPlugin(path.join(__dirname, '..'))
    .create()
    .then(function (result) {
        assert(result[0].content === matched);
    });
